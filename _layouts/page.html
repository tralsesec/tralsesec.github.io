---
layout: default
---

{% assign FORCE_DOMAIN = "https://tralsesec.github.io" %}

{% comment %} 2. CALCULATE ID {% endcomment %}
{% assign raw_id = page.id | split: "/" | last %}
{% assign clean_id = raw_id | plus: 0 %}

{% comment %} 3. BUILD URL {% endcomment %}
{% assign final_img_url = FORCE_DOMAIN | append: "/anatomy-of-a-bug/assets/og/" | append: clean_id | append: ".png" %}

{% comment %} 4. BUILD TEXT (Applied strip_html to fix meta tags) {% endcomment %}
{% assign series_name = "#! Anatomy of a Bug" %}
{% assign social_title = page.title | strip_html | append: " (#" | append: clean_id | append: ")" %}
{% assign social_desc = page.summary | default: page.excerpt | strip_html | strip_newlines | truncate: 200 %}

<meta property="og:type" content="article" />
<meta property="og:site_name" content="{{ series_name }}" />
<meta property="og:title" content="{{ social_title }}" />
<meta property="og:description" content="{{ social_desc }}" />
<meta property="og:url" content="{{ FORCE_DOMAIN }}{{ page.url }}" />

<meta name="theme-color" content="#6c189d">

<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:title" content="{{ social_title }}">
<meta property="twitter:description" content="{{ social_desc }}">
<meta name="twitter:site" content="{{ series_name }}">

<meta property="og:image" content="{{ final_img_url }}" />
<meta property="twitter:image" content="{{ final_img_url }}" />

<div class="page">

  <header class="intel-header-panel" style="border-bottom: 1px solid #444; padding-bottom: 1.5rem; margin-bottom: 2rem;">

    <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; gap: 1rem; margin-bottom: 1.5rem;">
      
      <h1 class="page-title" style="margin: 0; line-height: 1.1; padding-bottom: 0rem;">
        {% if page.title_prefix %}
          <span class="text-green" style="font-style: normal;">{{ page.title_prefix }}</span>
        {% endif %}
        {{ page.title }}
      </h1>
      
      {% if page.pdf_file %}
        {% assign pdf_url = "/anatomy-of-a-bug/pdf/" | append: page.pdf_file | relative_url %}
        <a href="{{ pdf_url }}" class="tactical-btn" download style="white-space: nowrap; font-size: 0.9em; padding: 6px 12px; border: 1px solid currentColor; text-decoration: none;">
          <span class="tactical-icon" style="margin-right:5px;">⬇</span> PDF REPORT
        </a>
      {% endif %}
    </div>

    <div class="intel-meta-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; font-family: monospace; font-size: 0.85em; color: #aaa; margin-bottom: 1rem;">
      
      <div class="meta-block">
        <div style="font-size: 0.75em; opacity: 0.6; margin-bottom: 2px;">STATUS</div>
        <div style="color: #fff; letter-spacing: 0.5px;">{{ page.status }}</div>
      </div>

      <div class="meta-block">
        <div style="font-size: 0.75em; opacity: 0.6; margin-bottom: 2px;">SEVERITY</div>
        <div class="text-red" style="font-weight: bold;">{{ page.severity }}</div>
      </div>

      <div class="meta-block">
        <div style="font-size: 0.75em; opacity: 0.6; margin-bottom: 2px;">DISCOVERED</div>
        <div>{{ page.date_finding | date: "%Y-%m-%d" }}</div>
      </div>

      <div class="meta-block">
        <div style="font-size: 0.75em; opacity: 0.6; margin-bottom: 2px;">UPLOADED</div>
        <div>{{ page.date_upload | date: "%Y-%m-%d" }}</div>
      </div>

    </div>

    {% if page.tags %}
    <div class="intel-tags" style="display: flex; flex-wrap: wrap; gap: 8px; font-family: monospace; font-size: 0.75em;">
      {% for tag in page.tags %}
        <span style="background: rgba(255,255,255,0.05); border: 1px solid #444; padding: 2px 8px; border-radius: 2px; color: #888;">#{{ tag | upcase }}</span>
      {% endfor %}
    </div>
    {% endif %}

  </header>

  {% if page.images %}
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 2rem 0;">
    {% for img in page.images %}
    <div class="intel-frame" style="border: 1px solid var(--border); padding: 5px; background: #000; transition: transform 0.2s ease;">
      <a href="{{ img.url }}" target="_blank" style="border: none; display: block;">
        <img src="{{ img.url }}" alt="{{ img.ref }}" style="width: 100%; display: block; cursor: zoom-in;">
      </a>
      {% if img.ref %}
      <p style="font-family: var(--font-mono); font-size: 0.65rem; text-align: center; margin-top: 1rem; margin-bottom: 5px;" class="fg-dim">
        // IMG_REF: {{ img.ref }}
      </p>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  {% unless page.no_toc %}
  <div id="intel-toc" style="display: none; margin-bottom: 3rem; margin-top: 1rem;">
    
    <div style="
        border-bottom: 1px dashed #444; 
        padding-bottom: 0.5rem; 
        margin-bottom: 1rem; 
        font-family: monospace; 
        font-size: 0.85em; 
        color: #666;
    ">
      <span style="opacity: 0.5; margin-right: 10px;">// TABLE OF CONTENTS</span>
      <!--<strong>LOG_ENTRY_NAVIGATION</strong>-->
    </div>

    <ul id="toc-list" style="
        list-style: none; 
        padding: 0; 
        margin: 0; 
        font-family: monospace; 
        font-size: 0.9rem;
    ">
      </ul>
  {% endunless %}

  </div>

  <div class="intel-content">
    {{ content }}
  </div>

  {% if page.credits %}
  <div class="intel-credits" style="margin-top: 4rem; padding-top: 1rem; border-top: 1px dashed #444; font-family: monospace; text-align: right; color: #666; font-size: 0.85em;">
    <span style="margin-right: 10px; opacity: 0.5;">// END TRANSMISSION</span>
    <strong>CREDIT: {{ page.credits }}</strong>
  </div>
  {% endif %} 

</div>

{% include related_aoabs.html %}

<style>
/* --- TABLE OF CONTENTS (Stealth Mode) --- */
#intel-toc {
  display: none;
  margin-bottom: 4rem;
  margin-top: 1rem;
  /* NO BOX, NO BORDER, NO BACKGROUND */
  border: none;
  background: transparent;
  padding: 0;
  position: relative;
}

/* The Label: Looks like a code comment */
#intel-toc .toc-label {
  font-family: var(--font-mono);
  font-size: 0.65rem;
  color: #444; /* Very dark/subtle */
  margin-bottom: 1rem;
  margin-left: 1px; /* Align with the timeline line */
  text-transform: uppercase;
  letter-spacing: 0.1em;
  user-select: none;
}

/* The List Container */
#toc-list {
  list-style: none;
  padding: 0;
  margin: 0;
  font-family: var(--font-mono);
  font-size: 0.85rem;
  /* The "Timeline" Line */
  border-left: 1px solid #222; 
  padding-left: 0;
}

#toc-list li {
  margin-bottom: 0;
  position: relative;
}

/* --- H2 (Main Levels) --- */
.toc-h2 {
  padding-top: 8px;
  padding-bottom: 8px;
}

.toc-h2 a {
  display: flex;
  align-items: center;
  padding-left: 1.5rem;
  color: var(--fg-primary);
  border-bottom: none;
  transition: transform 0.2s ease;
}

/* The Hover Effect: Slide Right + Green Highlight */
.toc-h2 a:hover {
  color: var(--accent);
  transform: translateX(5px);
  border-bottom: none;
}

/* Add a tiny horizontal tick mark on the left line for H2s */
.toc-h2::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  width: 10px; /* Length of the tick */
  height: 1px;
  background-color: #222;
}

/* --- H3 (Sub Levels) --- */
.toc-h3 {
  padding-top: 4px;
  padding-bottom: 4px;
}

.toc-h3 a {
  padding-left: 3.5rem; /* Deep Indent */
  font-size: 0.75rem;   /* Smaller Text */
  color: var(--fg-dim); /* Dimmer Color */
  border-bottom: none;
  display: block;
}

.toc-h3 a:hover {
  color: #fff;
}

/* The Numbers / Symbols */
.toc-num {
  color: var(--accent); /* Hacker Green */
  font-weight: bold;
  margin-right: 12px;
  font-size: 0.9em;
  min-width: 20px; /* Align text even if numbers grow */
  display: inline-block;
}

/* --- SECTION ANCHORS (The # symbol) --- */
.anchor-link {
  opacity: 0;                /* Hidden by default */
  margin-left: 0.8rem;       /* Add space between Text and # */
  color: var(--fg-dim);      /* Dim color */
  text-decoration: none;     /* No underline */
  border-bottom: none !important; /* Force remove theme underline */
  font-size: 0.8em;
  transition: opacity 0.2s ease, transform 0.2s ease;
  cursor: pointer;
  
  /* Ensure it doesn't mess up layout */
  display: inline-block;
  vertical-align: middle;
}

/* REVEAL ON HOVER */
/* When you hover over the H2 or H3, show the anchor */
h2:hover .anchor-link,
h3:hover .anchor-link {
  opacity: 1;
  transform: translateX(3px); /* Subtle slide in */
}

/* Hovering over the # itself makes it bright */
.anchor-link:hover {
  color: var(--accent) !important;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const tocContainer = document.getElementById('intel-toc');
  const tocList = document.getElementById('toc-list');
  const headers = document.querySelectorAll('.intel-content h2, .intel-content h3');

  if (headers.length > 0) {
    tocContainer.style.display = 'block';

    let h2Count = 0;

    headers.forEach((header, index) => {
      // 1. Generate ID if missing
      if (!header.id) {
        const slug = header.textContent
          .toLowerCase()
          .trim()
          .replace(/[^\w\s-]/g, '')
          .replace(/[\s_-]+/g, '-');
        header.id = slug || `section-${index}`;
      }

      // 2. Add Anchor Link (#)
      const anchor = document.createElement('a');
      anchor.href = `#${header.id}`;
      anchor.className = 'anchor-link';
      anchor.textContent = '#';
      header.appendChild(anchor);

      // 3. Prepare TOC Data
      const li = document.createElement('li');
      const link = document.createElement('a');
      link.href = `#${header.id}`;

      // --- THE FIX: INTELLIGENT NUMBER PARSING ---
      
      let rawText = header.childNodes[0].textContent.trim();
      let displayNum = "";
      let displayText = rawText;

      // Check if the text ALREADY starts with a number (e.g., "1. The Patient")
      // Regex looks for: Start of line -> digits -> dot -> optional digits -> dot -> space
      const existingNumMatch = rawText.match(/^(\d+(?:\.\d+)*)\.?\s+(.*)/);

      if (header.tagName === 'H2') {
        li.className = 'toc-h2';
        h2Count++;

        if (existingNumMatch) {
            // Case A: User wrote "1. The Patient"
            // We use "01" (padded version of their "1") and strip the number from the text
            let foundNum = existingNumMatch[1]; // "1"
            displayNum = foundNum.padStart(2, '0'); // "01"
            displayText = existingNumMatch[2]; // "The Patient"
        } else {
            // Case B: User wrote "The Patient" (No number)
            // We generate our own number
            displayNum = h2Count.toString().padStart(2, '0');
            displayText = rawText;
        }

      } else if (header.tagName === 'H3') {
        li.className = 'toc-h3';
        
        if (existingNumMatch) {
            // User wrote "1.1 Subpoint"
            displayNum = existingNumMatch[1]; // "1.1"
            displayText = existingNumMatch[2]; // "Subpoint"
        } else {
            // User wrote "Subpoint"
            displayNum = "└"; 
            displayText = rawText;
        }
      }

      // 4. Construct HTML
      link.innerHTML = `<span class="toc-num">${displayNum}</span> ${displayText}`;
      
      li.appendChild(link);
      tocList.appendChild(li);
    });
  }
});
</script>
